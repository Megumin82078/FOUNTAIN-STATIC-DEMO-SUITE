<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fountain AI Tool Box Demo</title>
  <style>
    :root {
      --primary: #1a73e8;
      --primary-light: #4285f4;
      --primary-dark: #0d47a1;
      --secondary: #34a853;
      --accent: #fbbc05;
      --danger: #ea4335;
      --light: #f8f9fa;
      --dark: #202124;
      --gray: #5f6368;
      --shadow: 0 4px 6px rgba(32, 33, 36, 0.28);
      --glow: 0 0 15px rgba(26, 115, 232, 0.6);
      --font-family: 'Segoe UI', Roboto, Arial, sans-serif;
      /* Add a warning color variable for AI Analysis warnings */
      --warning-color: #d32f2f;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family);
      color: var(--dark);
      background-color: var(--light);
      min-height: 100vh;
      position: relative;
    }

    .header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 1rem 2rem;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      font-weight: bold;
      font-size: 1.5rem;
      gap: 0.5rem;
    }

    .content {
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Floating Action Button (FAB) and Menu */
    .fab-container {
      position: fixed;
      bottom: 2.5rem;
      right: 2.5rem;
      z-index: 999;
      width: 0;
      height: 0;
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }
    .fab-container.active {
      bottom: 50%;
      right: 50%;
      transform: translate(50%, 50%);
    }

    .fab {
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-radius: 50%;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      cursor: pointer;
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      position: absolute;
      top: -35px;
      left: -35px;
      z-index: 2;
    }
    .fab:hover {
      box-shadow: var(--glow);
      transform: scale(1.08);
    }
    .fab-container.active .fab {
      box-shadow: var(--glow);
      transform: scale(1.2);
    }
    .fab-icon {
      font-size: 28px;
      transition: transform 0.3s ease;
    }
    .fab-container.active .fab-icon {
      transform: rotate(45deg);
    }
    .fab-ripple {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.3);
      transform: scale(0);
      animation: ripple 1.5s ease-out infinite;
      z-index: 1;
    }
    @keyframes ripple {
      0% {
        transform: scale(0.9);
        opacity: 0.3;
      }
      100% {
        transform: scale(1.5);
        opacity: 0;
      }
    }

    .fab-menu {
      position: absolute;
      top: -35px;
      left: -35px;
      width: 70px;
      height: 70px;
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      z-index: 1;
    }
    .fab-container.active .fab-menu {
      width: 350px;
      height: 350px;
      top: -175px;
      left: -175px;
    }

    .menu-item {
      position: absolute;
      width: 60px;
      height: 60px;
      background: white;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: background 0.3s, color 0.3s, box-shadow 0.3s, opacity 0.3s;
      opacity: 0;
      color: var(--primary);
      font-size: 1.2rem;
      top: calc(50% - 30px);
      left: calc(50% - 30px);
    }
    .fab-container.active .menu-item {
      opacity: 1;
      transform-origin: center center;
    }
    .menu-item:hover {
      background: linear-gradient(135deg, var(--primary-light), var(--primary));
      color: white;
      box-shadow: var(--glow);
    }

    .menu-item span {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      font-size: 0.9rem;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      pointer-events: none;
      transform: translateY(10px);
      z-index: 3;
    }
    .menu-item:hover span {
      opacity: 1;
      transform: translateY(0);
    }

    /* Circle positions for icons */
    .fab-container.active .menu-item:nth-child(1) {
      transform: translate(0, -120px);
    }
    .fab-container.active .menu-item:nth-child(2) {
      transform: translate(104px, -60px);
    }
    .fab-container.active .menu-item:nth-child(3) {
      transform: translate(104px, 60px);
    }
    .fab-container.active .menu-item:nth-child(4) {
      transform: translate(0, 120px);
    }
    .fab-container.active .menu-item:nth-child(5) {
      transform: translate(-104px, 60px);
    }
    .fab-container.active .menu-item:nth-child(6) {
      transform: translate(-104px, -60px);
    }

    /* Tool panels */
    .tool-panel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: white;
      z-index: 1000;
      display: none;
      flex-direction: column;
      animation: slideIn 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
      backdrop-filter: blur(10px);
    }
    @keyframes slideIn {
      from {
        transform: translateY(30px) scale(0.97);
        opacity: 0;
      }
      to {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }

    .tool-header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 1.2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .tool-title {
      font-size: 1.4rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }
    .tool-title svg {
      width: 24px;
      height: 24px;
    }

    .close-tool {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .close-tool:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }

    .tool-content {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
      background-color: #f8f9fa;
    }

    .card {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
    }

    .card-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--primary-dark);
    }
    .placeholder-content {
      height: 200px;
      background-color: white;
      border-radius: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 1.5rem;
      color: var(--gray);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      border: 1px dashed var(--primary-light);
      font-weight: 500;
    }

    .fancy-btn {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      border-radius: 30px;
      padding: 0.8rem 1.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(26, 115, 232, 0.3);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    .fancy-btn:hover {
      box-shadow: 0 6px 12px rgba(26, 115, 232, 0.4);
      transform: translateY(-2px);
    }

    .form-group {
      margin-bottom: 1.5rem;
    }
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--dark);
    }
    .form-input {
      width: 100%;
      padding: 0.8rem 1rem;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      font-family: var(--font-family);
      transition: all 0.3s ease;
    }
    .form-input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
    }

    /* ----------------------------------------------
       COLLAPSE / EXPAND  for "View" details
       ---------------------------------------------- */
    .detail-content {
      display: none;
      margin: 1rem 0 1.5rem 1.5rem;
      border-left: 3px solid var(--primary-light);
      padding-left: 1rem;
    }
    .detail-content h4 {
      margin: 0.5rem 0 0.5rem 0;
      color: var(--primary-dark);
    }
    .view-link {
      color: var(--primary-dark);
      font-weight: 600;
      cursor: pointer;
      text-decoration: underline;
    }
    .view-link:hover {
      text-decoration: none;
    }

    /* For alert highlights in AI Analysis */
    .warning {
      color: var(--warning-color);
      font-weight: bold;
    }

    /* Basic table styling for prescriptions */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }
    th, td {
      padding: 0.75rem;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #e2e6ea;
    }
    td > input, td > select {
      width: 95%;
      padding: 0.4rem;
      margin: 0;
      box-sizing: border-box;
    }
    td > button {
      cursor: pointer;
    }
    .delete-btn {
      background-color: #e53935;
      border: none;
      color: white;
      border-radius: 4px;
      padding: 0.3rem 0.5rem;
    }
    .add-btn {
      background-color: #4caf50;
      border: none;
      color: white;
      border-radius: 4px;
      padding: 0.3rem 0.7rem;
    }

    /* ===== RISKY DRUG MODAL ===== */
    #riskyModal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    #riskyModalContent {
      background-color: white;
      max-width: 400px;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: var(--shadow);
    }
    #riskyModalContent p {
      margin-bottom: 1rem;
    }
    .modal-btn {
      display: inline-block;
      margin-right: 0.5rem;
      padding: 0.4rem 1rem;
      border: none;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
    }
    .cancel-btn {
      background-color: #d32f2f;
    }
    .continue-btn {
      background-color: #34a853;
    }

    /* ===== MODAL for Authorization ===== */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .modal-content {
      background-color: white;
      padding: 2rem;
      max-width: 500px;
      border-radius: 8px;
      box-shadow: var(--shadow);
    }
    .modal-buttons {
      margin-top: 1rem;
      display: flex;
      gap: 1rem;
    }

    .status-active {
      color: green;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- Header Title -->
  <div style="text-align: center; padding: 2rem 0;">
    <h1 style="font-size: 2rem; color: var(--primary-dark); margin-bottom: 0.5rem;">
      Fountain AI Tool Box Demo
    </h1>
  </div>

  <!-- FAB and Menu -->
  <div class="fab-container">
    <div class="fab">
      <div class="fab-ripple"></div>
      <div class="fab-icon">+</div>
    </div>
    <div class="fab-menu">
      <div class="menu-item" data-tool="patient-info">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
        <span>Patient General Info</span>
      </div>
      <div class="menu-item" data-tool="patient-record">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
        </svg>
        <span>Patient's Record</span>
      </div>
      <div class="menu-item" data-tool="ai-analysis">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 12c0-4.97-4.03-9-9-9s-9 4.03-9 9c0 4.97 4.03 9 9 9s9-4.03 9-9zm-9 7c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7z"/>
          <path d="M10 8v6l4.7 2.9.8-1.2-4-2.4V8z"/>
          <path d="M17.92 12c.05.33.08.66.08 1 0 3.9-3.1 7-7 7s-7-3.1-7-7 3.1-7 7-7c.34 0 .67.03 1 .08V4.07C11.67 4.02 11.34 4 11 4c-5 0-9 4-9 9s4 9 9 9 9-4 9-9c0-.34-.02-.67-.07-1h-2.01z"/>
        </svg>
        <span>AI Analysis</span>
      </div>
      <div class="menu-item" data-tool="auto-doc">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
        </svg>
        <span>Automated Documentation</span>
      </div>
      <div class="menu-item" data-tool="Prescription">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M16.95 7.05a7 7 0 0 0-9.9 9.9l6.9-6.9 3-3zm1.41 1.41-3 3-6.9 6.9a7 7 0 1 0 9.9-9.9zM8.46 14.12l1.41 1.41 6.24-6.24-1.41-1.41-6.24 6.24z"/>
        </svg>
        <span>Prescription</span>
      </div>
      <div class="menu-item" data-tool="authorization">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
        </svg>
        <span>Authorization</span>
      </div>
    </div>
  </div>

  <!-- =========================
       Panels Begin Here
       ========================= -->

  <!-- 1) Automated Documentation Panel (Revised with Template Editor, Input Section, and Generated Note) -->
  <div id="auto-doc" class="tool-panel">
    <div class="tool-header">
      <div class="tool-title">AI Automated Documentation (DEMO)</div>
      <button class="close-tool">&times;</button>
    </div>
    <div class="tool-content">
      <h2 style="margin-bottom:1.5rem;">AI Automated Documentation (DEMO)</h2>
      <!-- Template Section -->
      <div class="card" style="margin-bottom:2rem;">
        <h3 class="card-title" style="margin-bottom:0.5rem;">Template Section</h3>
        <p style="margin-bottom:1rem;">
          <a href="#" id="editTemplateLink" style="text-decoration:underline; color:var(--primary-dark);">
            Click Here to Edit Template Preference
          </a>
        </p>
        <!-- Hidden area for editing the template preference -->
        <div id="templateEditor" style="display:none; margin-top:1rem;">
          <h4 style="margin-bottom:0.5rem;">Customize Your Template</h4>
          <textarea id="templateTextArea" rows="4" style="width:100%;"></textarea>
          <br/><br/>
          <button id="saveTemplateBtn" class="fancy-btn">Save Template</button>
        </div>
      </div>
      <!-- Input Section -->
      <div class="card" style="margin-bottom:2rem;">
        <h3 class="card-title">Input Section</h3>
        <div style="margin-bottom:1rem;">
          <label for="visitInput" style="font-weight:600;">Type Your Notes:</label>
          <textarea id="visitInput" rows="6" style="width:100%;"></textarea>
        </div>
        <div>
          <button id="micButton" class="fancy-btn" style="margin-right:10px;">🎤</button>
          <button id="submitVisitBtn" class="fancy-btn">Submit</button>
        </div>
      </div>
      <!-- Generated Note Section -->
      <div class="card" id="generatedSection" style="display:none;">
        <h3 class="card-title">Generated Note</h3>
        <textarea id="generatedNoteContent" rows="14" style="width:100%;">
S – Subjective:
Patient reports feeling well. No hypoglycemic symptoms, dizziness, or chest pain. Medication adherence is good.

O – Objective:
BP: 142/88 mmHg
HbA1c: 6.8% (LifeLabs, March 1, 2025)
BMI: 28.3
Vitals otherwise unremarkable.

A – Assessment:
T2DM, stable on current regimen
Hypertension, mildly elevated
No new symptoms or complications

P – Plan:
Continue Metformin 500mg BID
Reinforce dietary sodium reduction
Lipid panel in 1 month
Next follow-up in 2 months
EpiPen renewal confirmed
        </textarea>
        <div style="margin-top:1rem;">
          <button id="regenerateBtn" class="fancy-btn" style="margin-right:8px;">Regenerate</button>
          <button id="updateEmrBtn" class="fancy-btn" style="margin-right:8px;">Update EMR</button>
          <button id="copyNoteBtn" class="fancy-btn" style="margin-right:8px;">Copy Note</button>
          <button id="editNoteBtn" class="fancy-btn">Edit Note</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 2) Prescription Panel (Enhanced Version) -->
  <div id="Prescription" class="tool-panel">
    <div class="tool-header">
      <div class="tool-title">💊 Fountain – AI-Enhanced Prescription Interface (DEMO)</div>
      <button class="close-tool">&times;</button>
    </div>
    <div class="tool-content">
      <!-- Header Info -->
      <h2 style="margin-bottom:1rem;">Prescription for Jason Lee</h2>
      <div style="margin-bottom:2rem;">
        <p><strong>Patient:</strong> Jason Lee (DOB: June 12, 1979)<br/>
          <strong>Health Card #:</strong> 9375-123-776-XX<br/>
          <strong>Allergies:</strong> Shellfish – Anaphylaxis, Penicillin – Rash
        </p>
        <p>
          <strong>Prescriber:</strong> Dr. Emily Harris (CPSO #123456)<br/>
          <strong>Clinic:</strong> Downtown Medical Group<br/>
          <strong>Date:</strong> April 8, 2025  <strong>Prescription ID:</strong> RX-2025-0410-JC
        </p>
      </div>
      <!-- AI Warnings & Guidance Panel -->
      <div class="card" style="margin-bottom:2rem;">
        <h3 class="card-title">🧠 AI Warnings & Clinical Guidance</h3>
        <p style="font-weight:600;">Based on Jason Lee’s conditions, active meds, and allergies:</p>
        <div style="margin-left:1.5rem;">
          <p><strong>Current Active Medications:</strong></p>
          <ul style="list-style-type: disc; margin-left:1.5rem;">
            <li>Metformin 500 mg BID – T2 Diabetes</li>
            <li>Lisinopril 10 mg OD – Hypertension</li>
            <li>Salbutamol Inhaler PRN – Asthma</li>
          </ul>
          <p><strong>AI Insights / Warnings:</strong></p>
          <ul style="list-style-type: disc; margin-left:1.5rem;">
            <li>Avoid KCl with Lisinopril → risk of hyperkalemia</li>
            <li>Avoid NSAIDs (e.g., Ibuprofen) with Lisinopril → possible renal impact</li>
            <li>Penicillin allergy flagged → avoid amoxicillin &amp; other β-lactams</li>
            <li>Monitor Metformin dose with eGFR 78</li>
            <li>Shellfish allergy → caution with iodine contrast agents</li>
          </ul>
        </div>
      </div>
      <!-- Add New Prescription Section -->
      <div class="card" style="margin-bottom:2rem;">
        <h3 class="card-title">💊 Add New Prescription</h3>
        <!-- Medication List -->
        <h4 style="margin-bottom:0.75rem;">Medication List</h4>
        <table id="medListTable" style="margin-bottom:1.5rem;">
          <thead>
            <tr>
              <th>Drug Name</th>
              <th>Risk Level</th>
              <th>AI Reaction</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr data-drug="Amoxicillin" data-risk="high" data-note="Allergy: Penicillin">
              <td>Amoxicillin</td>
              <td>🚨 High Risk</td>
              <td><em>Penicillin allergy</em></td>
              <td><button class="add-btn addMed">Add</button></td>
            </tr>
            <tr data-drug="Ibuprofen" data-risk="medium" data-note="Interaction with Lisinopril">
              <td>Ibuprofen</td>
              <td>⚠️ Moderate Risk</td>
              <td><em>Interaction with Lisinopril</em></td>
              <td><button class="add-btn addMed">Add</button></td>
            </tr>
            <tr data-drug="KCl" data-risk="medium" data-note="Risk of Hyperkalemia with ACE Inhibitor">
              <td>KCl (Potassium)</td>
              <td>⚠️ Moderate Risk</td>
              <td><em>Hyperkalemia risk</em></td>
              <td><button class="add-btn addMed">Add</button></td>
            </tr>
            <tr data-drug="Atenolol" data-risk="safe" data-note="No interactions">
              <td>Atenolol</td>
              <td>✅ Safe</td>
              <td>No interactions – used in HTN mgmt</td>
              <td><button class="add-btn addMed">Add</button></td>
            </tr>
            <tr data-drug="Atorvastatin" data-risk="safe" data-note="Recommended for elevated LDL">
              <td>Atorvastatin</td>
              <td>✅ Safe/Recommended</td>
              <td>Suggested for elevated LDL</td>
              <td><button class="add-btn addMed">Add</button></td>
            </tr>
            <tr data-drug="Sulfamethoxazole" data-risk="medium" data-note="Sulfa caution">
              <td>Sulfamethoxazole</td>
              <td>⚠️ Moderate Risk</td>
              <td><em>Mild sulfa allergy risk</em></td>
              <td><button class="add-btn addMed">Add</button></td>
            </tr>
            <tr data-drug="Insulin Glargine" data-risk="safe" data-note="Safe for T2DM escalation">
              <td>Insulin Glargine</td>
              <td>✅ Safe</td>
              <td>For diabetes therapy escalation</td>
              <td><button class="add-btn addMed">Add</button></td>
            </tr>
            <tr data-drug="Prednisone" data-risk="medium" data-note="May raise blood sugar">
              <td>Prednisone</td>
              <td>⚠️ Caution</td>
              <td>Diabetes warning</td>
              <td><button class="add-btn addMed">Add</button></td>
            </tr>
            <tr data-drug="Metronidazole" data-risk="safe" data-note="No interaction in this profile">
              <td>Metronidazole</td>
              <td>✅ Safe</td>
              <td>No interaction in this profile</td>
              <td><button class="add-btn addMed">Add</button></td>
            </tr>
          </tbody>
        </table>
        <!-- Currently Added Medications Table -->
        <h4 style="margin-bottom:0.75rem;">Currently Added</h4>
        <table id="rxTable">
          <thead>
            <tr>
              <th>Drug Name</th>
              <th>Strength</th>
              <th>Form</th>
              <th>Directions</th>
              <th>Qty</th>
              <th>Refills</th>
              <th>Duration</th>
              <th>Notes</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <!-- Example Row 1: Metformin -->
            <tr>
              <td><input value="Metformin"></td>
              <td><input value="500 mg"></td>
              <td><input value="Tablet"></td>
              <td><input value="Take 1 tab BID with meals"></td>
              <td><input value="180"></td>
              <td><input value="0"></td>
              <td><input value="90 days"></td>
              <td><input value="T2DM"></td>
              <td><button class="delete-btn">❌</button></td>
            </tr>
            <!-- Example Row 2: Lisinopril -->
            <tr>
              <td><input value="Lisinopril"></td>
              <td><input value="10 mg"></td>
              <td><input value="Tablet"></td>
              <td><input value="Take 1 tab daily"></td>
              <td><input value="90"></td>
              <td><input value="0"></td>
              <td><input value="3 months"></td>
              <td><input value="Hypertension"></td>
              <td><button class="delete-btn">❌</button></td>
            </tr>
            <!-- Add More Row -->
            <tr>
              <td colspan="9" style="text-align:right;">
                <button id="addEmptyRowBtn" class="add-btn">➕ Add Custom Medication</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- Risky Drug Modal -->
      <div id="riskyModal">
        <div id="riskyModalContent">
          <p style="font-weight:bold; color:var(--warning-color); font-size:1.1rem; margin-bottom:0.5rem;">
            🛑 Risky Drug
          </p>
          <p id="riskyDrugMessage">This drug may pose a serious risk.</p>
          <button id="cancelRiskBtn" class="modal-btn cancel-btn">Cancel Prescription</button>
          <button id="continueRiskBtn" class="modal-btn continue-btn">Continue Anyway</button>
        </div>
      </div>
      <!-- Prescription Preview Output -->
      <div class="card" style="margin-bottom:2rem;">
        <h3 class="card-title">📄 Prescription Preview Output</h3>
        <p><strong>Metformin 500 mg tablet</strong><br/>
          Sig: Take 1 tablet by mouth twice daily with meals<br/>
          Qty: 180  Refills: 0  Duration: 90 days<br/>
          Indication: Type 2 Diabetes
        </p>
        <p><strong>Lisinopril 10 mg tablet</strong><br/>
          Sig: Take 1 tablet by mouth daily<br/>
          Qty: 90  Refills: 0  Duration: 3 months<br/>
          Indication: Hypertension
        </p>
        <p style="margin-bottom:1rem;">
          ✅ <em>Allergies, lab data, and interaction checks have been reviewed by AI.</em>
        </p>
        <div>
          <button class="fancy-btn" style="margin-right:8px;">✅ Send to Pharmacy</button>
          <button class="fancy-btn" style="margin-right:8px;">📎 Download PDF</button>
          <button class="fancy-btn" style="margin-right:8px;">📋 Copy Note</button>
          <button class="fancy-btn" style="margin-right:8px;">🖊️ Edit Prescription</button>
          <button class="fancy-btn">⏳ Save as Draft</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 3) Authorization Panel (New Full Content) -->
  <div id="authorization" class="tool-panel">
    <div class="tool-header">
      <div class="tool-title">Authorization</div>
      <button class="close-tool">&times;</button>
    </div>
    <div class="tool-content">
      <!-- Current Access Status Table -->
      <div class="card" style="margin-bottom:2rem;">
        <h3 class="card-title">🔐 Your Current Access Status</h3>
        <table>
          <thead>
            <tr>
              <th>Patient</th>
              <th>Access Type</th>
              <th>Access Granted</th>
              <th>Expires</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Jason Lee</td>
              <td>Full Medical Access</td>
              <td>Mar 3, 2024</td>
              <td>Until Revoked</td>
              <td class="status-active">✅ Active</td>
              <td>
                <button id="revokeAccessBtn" class="fancy-btn" style="padding:0.4rem 1rem;">Revoke Access</button>
              </td>
            </tr>
          </tbody>
        </table>
        <p style="margin-top:1rem;">
          You currently have full access to Johnathan Carter’s health records. This includes visit history, labs, imaging, and AI summaries. You may revoke or extend access, subject to patient approval.
        </p>
      </div>
      <!-- Manage Your Access -->
      <div class="card" style="margin-bottom:2rem;">
        <h3 class="card-title">⚙️ Manage Your Access</h3>
        <!-- 1) Extend Access -->
        <div style="margin-bottom:1rem;">
          <button id="extendAccessBtn" class="fancy-btn" style="margin-bottom:0.5rem;">🔁 Extend Access</button>
          <div id="extendAccessPanel" style="display:none; margin-top:1rem; background:#fff4e6; padding:1rem; border-radius:8px;">
            <div>
              <label style="font-weight:600;">Duration:</label>
              <select id="extendDurationSelect" style="padding:0.5rem; margin-left:0.5rem;">
                <option value="30 days">30 days</option>
                <option value="6 months">6 months</option>
                <option value="1 year">1 year</option>
              </select>
            </div>
            <p style="margin:0.5rem 0;">Confirmation: A request will be sent to the patient for approval.</p>
            <div style="margin-top:0.5rem;">
              <button id="cancelExtendBtn" class="fancy-btn" style="margin-right:10px;">Cancel</button>
              <button id="requestExtendBtn" class="fancy-btn">Request Extension</button>
            </div>
          </div>
        </div>
        <!-- 2) Revoke Access -->
        <div style="margin-bottom:1rem;">
          <button id="revokeAccessBtn2" class="fancy-btn" style="background:#ea4335;">❌ Revoke Access</button>
          <p style="margin-top:0.5rem;">
            If you no longer require access, you can voluntarily revoke it. Useful for discharges or referrals.
          </p>
        </div>
        <!-- 3) Request New Access -->
        <div style="margin-bottom:1rem;">
          <button id="requestNewAccessBtn" class="fancy-btn" style="background:#34a853;">🟢 Request New Access</button>
          <div id="requestNewAccessPanel" style="display:none; margin-top:1rem; background:#e8f5e9; padding:1rem; border-radius:8px;">
            <label style="font-weight:600;">Access Level:</label>
            <select id="accessLevelSelect" style="padding:0.5rem; margin-left:0.5rem; margin-bottom:0.5rem;">
              <option value="Full">Full</option>
              <option value="Read-Only">Read-Only</option>
              <option value="Lab-Only">Lab-Only</option>
            </select>
            <div style="margin:0.5rem 0;">
              <label style="font-weight:600;">Purpose:</label><br/>
              <textarea id="accessPurpose" rows="3" style="width:100%;"></textarea>
            </div>
            <div style="margin:0.5rem 0;">
              <label style="font-weight:600;">Duration:</label>
              <select id="newAccessDurationSelect" style="padding:0.5rem; margin-left:0.5rem;">
                <option value="1 week">1 Week</option>
                <option value="30 days">30 Days</option>
                <option value="6 months">6 Months</option>
                <option value="Custom">Custom</option>
              </select>
            </div>
            <p style="margin:0.5rem 0;">Patient consent required ✅</p>
            <div style="margin-top:0.5rem;">
              <button id="submitNewAccessBtn" class="fancy-btn">Submit Request</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Revoke Confirmation Modal for Authorization -->
      <div id="revokeModal" class="modal-overlay">
        <div class="modal-content">
          <h3 style="margin-bottom:0.5rem;">Revoke Access?</h3>
          <p style="margin-bottom:1rem;">
            Are you sure you want to revoke your access to this patient’s Health Wallet? This will immediately restrict your ability to view or edit data.
          </p>
          <div class="modal-buttons">
            <button id="cancelRevokeBtn" class="fancy-btn" style="background:gray;">Cancel</button>
            <button id="confirmRevokeBtn" class="fancy-btn" style="background:#d32f2f;">Confirm Revoke</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 4) Patient Info Panel (Unchanged) -->
  <div id="patient-info" class="tool-panel">
    <div class="tool-header">
      <div class="tool-title">Patient General Info</div>
      <button class="close-tool">&times;</button>
    </div>
    <div class="tool-content">
      <div class="card">
        <h2 style="text-align: center; margin-bottom: 1.5rem;">Fountain ID: LEEJ-6666-8888</h2>
        <p><strong>Patient Name:</strong> Jason Lee</p>
        <p><strong>Gender:</strong> Male</p>
        <p><strong>Date of Birth:</strong> June 12, 1979 (Age: 45)</p>
        <p><strong>Health Card Number:</strong> 9375-123-776-XX</p>
        <p><strong>Phone:</strong> (416) 555-8123</p>
        <p><strong>Email:</strong> Lee.Jason@email.com</p>
        <p><strong>Primary Language:</strong> English</p>
        <p>
          <strong>Preferred Pharmacy:</strong>
          Shoppers Drug Mart (Yonge &amp; Eglinton)
        </p>
        <p>
          <strong>Emergency Contact:</strong>
          Sarah Carter (Wife) – (416) 555-9883
        </p>
      </div>
    </div>
  </div>

  <!-- 5) Patient Record Panel (With Expansions) -->
  <div id="patient-record" class="tool-panel">
    <div class="tool-header">
      <div class="tool-title">Patient’s Record</div>
      <button class="close-tool">&times;</button>
    </div>
    <div class="tool-content">
      <h2 style="margin-bottom:1rem;">🗂️ Patient Record – Jason Lee</h2>
      <p style="margin-bottom:1.5rem;">
        <strong>Note:</strong> The information below provides an outline summary of key clinical events,
        labs, and immunizations. Full medical details (diagnoses, vitals, clinical notes, attachments)
        will display only when you click “View.”
      </p>

      <!-- 1. Encounter History -->
      <div class="card" style="margin-bottom:2rem;">
        <h3 class="card-title">1. Encounter History</h3>
        <div style="overflow-x:auto;">
          <table style="width:100%; border-collapse:collapse; margin:1rem 0;">
            <thead>
              <tr style="background:#e2e6ea;">
                <th style="padding:0.75rem; text-align:left;">Date</th>
                <th style="padding:0.75rem; text-align:left;">Facility / Provider</th>
                <th style="padding:0.75rem; text-align:left;">Reason for Visit</th>
                <th style="padding:0.75rem; text-align:left;">View</th>
              </tr>
            </thead>
            <tbody>
              <!-- 2025-03-04 -->
              <tr>
                <td style="padding:0.75rem;">2025-03-04</td>
                <td style="padding:0.75rem;">Downtown Medical Group – Dr. Emily Harris</td>
                <td style="padding:0.75rem;">Routine Diabetes &amp; BP Check</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="encounter-1">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="4" style="border-bottom:1px solid #ddd;">
                  <div id="encounter-1" class="detail-content">
                    <h4>2025-03-04 – Routine Diabetes &amp; BP Check</h4>
                    <ul>
                      <li><strong>Physician:</strong> Dr. Emily Harris</li>
                      <li><strong>Vitals:</strong> BP: 142/88, HR: 82, Temp: 36.7°C, BMI: 28.3</li>
                      <li><strong>Notes:</strong> Type 2 Diabetes &amp; hypertension follow-up. On Metformin &amp; Lisinopril. No dizziness/hypo/chest issues.</li>
                      <li><strong>Plan:</strong> Increase dietary fiber, reduce sodium, continue meds, repeat labs in 2 months, next follow-up May 2.</li>
                    </ul>
                  </div>
                </td>
              </tr>
              <!-- 2025-01-08 -->
              <tr>
                <td style="padding:0.75rem;">2025-01-08</td>
                <td style="padding:0.75rem;">Mount Sinai Hospital (ER)</td>
                <td style="padding:0.75rem;">Anaphylaxis (Shellfish Allergy)</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="encounter-2">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="4" style="border-bottom:1px solid #ddd;">
                  <div id="encounter-2" class="detail-content">
                    <h4>2025-01-08 – ER Visit (Mount Sinai)</h4>
                    <ul>
                      <li><strong>Reason:</strong> Acute allergic reaction to shellfish</li>
                      <li><strong>Presentation:</strong> Difficulty breathing, facial swelling, urticaria</li>
                      <li><strong>Interventions:</strong> 0.3 mg epinephrine IM, IV Benadryl &amp; steroids, O₂ therapy</li>
                      <li><strong>Outcome:</strong> Monitored 8 hrs, recovered, discharged with EpiPen, updated allergy: Shellfish – severe.</li>
                    </ul>
                  </div>
                </td>
              </tr>
              <!-- 2024-11-15 -->
              <tr>
                <td style="padding:0.75rem;">2024-11-15</td>
                <td style="padding:0.75rem;">MedLife Labs – Walk-in Clinic</td>
                <td style="padding:0.75rem;">Asthma flare-up</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="encounter-3">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="4" style="border-bottom:1px solid #ddd;">
                  <div id="encounter-3" class="detail-content">
                    <h4>2024-11-15 – Asthma Flare-Up</h4>
                    <ul>
                      <li><strong>Location:</strong> MedLife Labs Walk-in Clinic</li>
                      <li><strong>Symptoms:</strong> Mild SOB, occasional wheeze</li>
                      <li><strong>Exam:</strong> Mild expiratory wheezing, SpO₂ 97%</li>
                      <li><strong>Treatment:</strong> Salbutamol inhaler, technique explained</li>
                      <li><strong>Follow-up:</strong> Referral to family doctor, watch frequency of episodes</li>
                    </ul>
                  </div>
                </td>
              </tr>
              <!-- 2024-08-21 -->
              <tr>
                <td style="padding:0.75rem;">2024-08-21</td>
                <td style="padding:0.75rem;">Sunnybrook Diagnostics</td>
                <td style="padding:0.75rem;">Annual Physical</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="encounter-4">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="4">
                  <div id="encounter-4" class="detail-content">
                    <h4>2024-08-21 – Annual Physical</h4>
                    <ul>
                      <li><strong>Facility:</strong> Sunnybrook Diagnostics</li>
                      <li><strong>General Health:</strong> Good energy, sleep, diet. No weight changes.</li>
                      <li><strong>Screenings:</strong> Cardiac exam normal, lungs clear, abdomen soft</li>
                      <li><strong>Orders:</strong> Lipid profile, HbA1c, fasting glucose</li>
                      <li><strong>Vaccine:</strong> Declined flu shot here, planned pharmacy</li>
                      <li><strong>Plan:</strong> Routine annual follow-up, await labs</li>
                    </ul>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- 2. Lab Results -->
      <div class="card" style="margin-bottom:2rem;">
        <h3 class="card-title">2. Lab Results</h3>
        <div style="overflow-x:auto;">
          <table style="width:100%; border-collapse:collapse; margin:1rem 0;">
            <thead>
              <tr style="background:#e2e6ea;">
                <th style="padding:0.75rem; text-align:left;">Date</th>
                <th style="padding:0.75rem; text-align:left;">Test</th>
                <th style="padding:0.75rem; text-align:left;">Key Result</th>
                <th style="padding:0.75rem; text-align:left;">View</th>
              </tr>
            </thead>
            <tbody>
              <!-- 2025-03-01 -->
              <tr>
                <td style="padding:0.75rem;">2025-03-01</td>
                <td style="padding:0.75rem;">HbA1c, Fasting Glucose</td>
                <td style="padding:0.75rem;">HbA1c 6.8%, Glucose 7.2 mmol/L</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="lab-1">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="4" style="border-bottom:1px solid #ddd;">
                  <div id="lab-1" class="detail-content">
                    <h4>2025-03-01 – HbA1c &amp; Fasting Glucose</h4>
                    <ul>
                      <li><strong>Lab:</strong> LifeLabs Ontario</li>
                      <li><strong>Ordering Physician:</strong> Dr. Emily Harris</li>
                      <li><strong>Results:</strong> HbA1c: 6.8% (target &lt;7%), Glucose 7.2 mmol/L (ref 3.9–5.5)</li>
                      <li><strong>Interpretation:</strong> Slightly above target, controlled but needs dietary focus.</li>
                      <li><strong>Plan:</strong> Keep Metformin, reassess in 3 months.</li>
                      <li><strong>PDF Download:</strong> <a href="#">2025-03-01_LifeLabs_HbA1c_Report.pdf</a></li>
                    </ul>
                  </div>
                </td>
              </tr>
              <!-- 2024-08-25 -->
              <tr>
                <td style="padding:0.75rem;">2024-08-25</td>
                <td style="padding:0.75rem;">Lipid Panel, Creatinine/eGFR</td>
                <td style="padding:0.75rem;">LDL 3.2 mmol/L, eGFR 78</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="lab-2">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="4">
                  <div id="lab-2" class="detail-content">
                    <h4>2024-08-25 – Lipid Panel &amp; Renal Function</h4>
                    <ul>
                      <li><strong>Lab:</strong> Sunnybrook Diagnostics</li>
                      <li><strong>Ordering Physician:</strong> Dr. Emily Harris</li>
                      <li><strong>Results:</strong> LDL: 3.2 (target &lt;2.6), HDL 1.1, eGFR 78, etc.</li>
                      <li><strong>Interpretation:</strong> Mild LDL elevation, otherwise normal. No statin yet.</li>
                      <li><strong>PDF Download:</strong> <a href="#">2024-08-25_Sunnybrook_Lipid_Renal_Panel.pdf</a></li>
                    </ul>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- 3. Specialist Consults -->
      <div class="card" style="margin-bottom:2rem;">
        <h3 class="card-title">3. Specialist Consults</h3>
        <div style="overflow-x:auto;">
          <table style="width:100%; border-collapse:collapse; margin:1rem 0;">
            <thead>
              <tr style="background:#e2e6ea;">
                <th style="padding:0.75rem; text-align:left;">Date</th>
                <th style="padding:0.75rem; text-align:left;">Specialty</th>
                <th style="padding:0.75rem; text-align:left;">Specialist</th>
                <th style="padding:0.75rem; text-align:left;">Summary</th>
                <th style="padding:0.75rem; text-align:left;">View</th>
              </tr>
            </thead>
            <tbody>
              <!-- 2024-09-18 -->
              <tr>
                <td style="padding:0.75rem;">2024-09-18</td>
                <td style="padding:0.75rem;">Endocrinology</td>
                <td style="padding:0.75rem;">Dr. Parveen Shah</td>
                <td style="padding:0.75rem;">Diabetes stable, continue meds</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="spec-1">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="5" style="border-bottom:1px solid #ddd;">
                  <div id="spec-1" class="detail-content">
                    <h4>2024-09-18 – Endocrinology Consult</h4>
                    <ul>
                      <li><strong>Referred by:</strong> Dr. Emily Harris</li>
                      <li><strong>Reason:</strong> Diabetic management check, insulin possibility</li>
                      <li><strong>Summary:</strong> HbA1c ~6.7%, no neuropathy, no retinopathy, no insulin needed.</li>
                      <li><strong>Plan:</strong> Continue meds, reassess in 12 months.</li>
                    </ul>
                  </div>
                </td>
              </tr>
              <!-- 2023-03-12 -->
              <tr>
                <td style="padding:0.75rem;">2023-03-12</td>
                <td style="padding:0.75rem;">Respirology</td>
                <td style="padding:0.75rem;">Dr. Amanda Leung</td>
                <td style="padding:0.75rem;">Asthma controlled, no steroids</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="spec-2">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="5">
                  <div id="spec-2" class="detail-content">
                    <h4>2023-03-12 – Respirology Consult</h4>
                    <ul>
                      <li><strong>Referred by:</strong> Walk-in after mild flare</li>
                      <li><strong>Summary:</strong> Mild persistent asthma, normal spirometry, no steroid inhaler needed.</li>
                      <li><strong>Plan:</strong> Trigger avoidance, keep Salbutamol PRN, follow up if worse.</li>
                    </ul>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- 4. Imaging & Procedures -->
      <div class="card" style="margin-bottom:2rem;">
        <h3 class="card-title">4. Imaging &amp; Procedures</h3>
        <div style="overflow-x:auto;">
          <table style="width:100%; border-collapse:collapse; margin:1rem 0;">
            <thead>
              <tr style="background:#e2e6ea;">
                <th style="padding:0.75rem; text-align:left;">Date</th>
                <th style="padding:0.75rem; text-align:left;">Type</th>
                <th style="padding:0.75rem; text-align:left;">Location</th>
                <th style="padding:0.75rem; text-align:left;">Findings</th>
                <th style="padding:0.75rem; text-align:left;">View</th>
              </tr>
            </thead>
            <tbody>
              <!-- 2023-12-10 -->
              <tr>
                <td style="padding:0.75rem;">2023-12-10</td>
                <td style="padding:0.75rem;">Chest X-Ray</td>
                <td style="padding:0.75rem;">Toronto General Imaging</td>
                <td style="padding:0.75rem;">Mild hyperinflation</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="img-1">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="5" style="border-bottom:1px solid #ddd;">
                  <div id="img-1" class="detail-content">
                    <h4>2023-12-10 – Chest X-Ray</h4>
                    <ul>
                      <li><strong>Radiology:</strong> Toronto General Imaging</li>
                      <li><strong>Referral:</strong> ER physician after asthma complaint</li>
                      <li><strong>Findings:</strong> Mild hyperinflation, no acute pathology.</li>
                      <li><strong>PDF Download:</strong> <a href="#">2023-12-10_TGH_Chest_Xray_Report.pdf</a></li>
                    </ul>
                  </div>
                </td>
              </tr>
              <!-- 2022-06-19 -->
              <tr>
                <td style="padding:0.75rem;">2022-06-19</td>
                <td style="padding:0.75rem;">Abdominal Ultrasound</td>
                <td style="padding:0.75rem;">Mount Sinai Diagnostics</td>
                <td style="padding:0.75rem;">Normal morphology</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="img-2">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="5">
                  <div id="img-2" class="detail-content">
                    <h4>2022-06-19 – Abdominal Ultrasound</h4>
                    <ul>
                      <li><strong>Facility:</strong> Mount Sinai Diagnostics</li>
                      <li><strong>Referral:</strong> Annual health screening</li>
                      <li><strong>Findings:</strong> Normal organ sizes, no stones, normal spleen and aorta.</li>
                      <li><strong>PDF Download:</strong> <a href="#">2022-06-19_MSH_Abdo_Ultrasound.pdf</a></li>
                    </ul>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- 5. Immunization History -->
      <div class="card">
        <h3 class="card-title">5. Immunization History</h3>
        <div style="overflow-x:auto;">
          <table style="width:100%; border-collapse:collapse; margin:1rem 0;">
            <thead>
              <tr style="background:#e2e6ea;">
                <th style="padding:0.75rem; text-align:left;">Vaccine</th>
                <th style="padding:0.75rem; text-align:left;">Date Given</th>
                <th style="padding:0.75rem; text-align:left;">Facility</th>
                <th style="padding:0.75rem; text-align:left;">Notes</th>
                <th style="padding:0.75rem; text-align:left;">View</th>
              </tr>
            </thead>
            <tbody>
              <!-- 2023-10-15 -->
              <tr>
                <td style="padding:0.75rem;">COVID-19 Booster</td>
                <td style="padding:0.75rem;">2023-10-15</td>
                <td style="padding:0.75rem;">Ontario Public Health</td>
                <td style="padding:0.75rem;">Moderna bivalent booster</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="immu-1">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="5" style="border-bottom:1px solid #ddd;">
                  <div id="immu-1" class="detail-content">
                    <h4>2023-10-15 – COVID-19 Booster</h4>
                    <ul>
                      <li><strong>Vaccine:</strong> Moderna bivalent mRNA-1273.214</li>
                      <li><strong>Lot #:</strong> C10004-21</li>
                      <li><strong>Site:</strong> Left deltoid</li>
                      <li><strong>Post-vaccination:</strong> No adverse events</li>
                      <li><strong>PDF Download:</strong> <a href="#">2023-10-15_COVID_Booster_Immunization.pdf</a></li>
                    </ul>
                  </div>
                </td>
              </tr>
              <!-- 2024-10-01 -->
              <tr>
                <td style="padding:0.75rem;">Influenza</td>
                <td style="padding:0.75rem;">2024-10-01</td>
                <td style="padding:0.75rem;">Shoppers Drug Mart</td>
                <td style="padding:0.75rem;">No adverse reactions</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="immu-2">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="5" style="border-bottom:1px solid #ddd;">
                  <div id="immu-2" class="detail-content">
                    <h4>2024-10-01 – Influenza Vaccine</h4>
                    <ul>
                      <li><strong>Vaccine:</strong> Influvac Tetra 2024–2025</li>
                      <li><strong>Lot #:</strong> FQX1329</li>
                      <li><strong>Facility:</strong> Shoppers Drug Mart (Yonge &amp; Eglinton)</li>
                      <li><strong>Observation:</strong> Mild soreness at site, no systemic reactions</li>
                      <li><strong>PDF Download:</strong> <a href="#">2024-10-01_Influenza_Immunization.pdf</a></li>
                    </ul>
                  </div>
                </td>
              </tr>
              <!-- 2022-06-10 -->
              <tr>
                <td style="padding:0.75rem;">Tetanus-Diphtheria</td>
                <td style="padding:0.75rem;">2022-06-10</td>
                <td style="padding:0.75rem;">Downtown Medical Group</td>
                <td style="padding:0.75rem;">Next due: 2032</td>
                <td style="padding:0.75rem;">
                  <span class="view-link" data-target="immu-3">View</span>
                </td>
              </tr>
              <tr>
                <td colspan="5">
                  <div id="immu-3" class="detail-content">
                    <h4>2022-06-10 – Tetanus-Diphtheria</h4>
                    <ul>
                      <li><strong>Vaccine:</strong> Td Adsorbed (Sanofi Pasteur)</li>
                      <li><strong>Lot #:</strong> TDA44-100</li>
                      <li><strong>Facility:</strong> Downtown Medical Group</li>
                      <li><strong>Next Due:</strong> June 2032</li>
                      <li><strong>Observation:</strong> No side effects.</li>
                      <li><strong>PDF Download:</strong> <a href="#">2022-06-10_Tetanus_Diphtheria_Vaccine.pdf</a></li>
                    </ul>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- 6) AI Analysis Panel (Unchanged) -->
  <div id="ai-analysis" class="tool-panel">
    <div class="tool-header">
      <div class="tool-title">AI Analysis</div>
      <button class="close-tool">&times;</button>
    </div>
    <div class="tool-content">
      <!-- Centered Title -->
      <h2 style="text-align:center; margin-bottom:0.5rem;">AI Analysis – Jason Lee</h2>
      <p style="text-align:center; font-style:italic; color:var(--gray); margin-bottom:2rem;">
        Auto-generated by Fountain AI. Last sync: April 6, 2025 – 08:15 AM
      </p>
      <p>This analysis summarizes key clinical trends and highlights relevant issues based on the patient’s latest records, labs, imaging, and specialist notes.</p>
      <hr style="margin:1.5rem 0;" />
      <!-- Summary -->
      <h3 style="margin-bottom:1rem;">📝 Summary</h3>
      <p>
        Jason Lee is a 45-year-old male with Type 2 Diabetes (diagnosed 2014), hypertension (2017), 
        and mild asthma. He is currently managed on Metformin, Lisinopril, and PRN Salbutamol. 
        His condition remains stable with good adherence to medications.
      </p>
      <p>
        Recent labs show HbA1c at <strong>6.8%</strong> (within target), but fasting glucose is mildly elevated (<strong>7.2 mmol/L</strong>). LDL remains elevated at <strong style="color:var(--warning-color);">3.2 mmol/L</strong>. BP at last visit was <strong style="color:var(--warning-color);">142/88 mmHg</strong>. He experienced a confirmed anaphylactic reaction to shellfish in January 2025 and carries a severe allergy flag.
      </p>
      <hr style="margin:1.5rem 0;" />
      <!-- Insights -->
      <h3 style="margin-bottom:1rem;">Insights</h3>
      <p>
        <strong>Metabolic Status:</strong><br/>
        Diabetes is reasonably controlled (<strong>HbA1c &lt;7%</strong>). No recent hypo-/hyperglycemic events. Fasting glucose drift suggests reinforcing dietary compliance.
      </p>
      <p>
        <strong>Hypertension:</strong><br/>
        BP borderline elevated. Patient tolerating Lisinopril well. Monitoring recommended before adjusting medications.
      </p>
      <p>
        <strong>Cardiovascular Risk:</strong><br/>
        Despite multiple risk factors (diabetes, HTN), patient is not on a statin. Current LDL: <strong style="color:var(--warning-color);">3.2 mmol/L</strong> &gt; recommended threshold. Statin initiation should be considered.
      </p>
      <p>
        <strong>Respiratory Health:</strong><br/>
        Asthma stable. Last imaging: mild hyperinflation, no acute changes. No steroid therapy needed.
      </p>
      <hr style="margin:1.5rem 0;" />
      <!-- Warnings -->
      <h3 style="margin-bottom:1rem;">⚠️ Warnings</h3>
      <ul style="list-style-type: disc; margin-left:1.5rem;">
        <li><span class="warning">Shellfish allergy – Anaphylaxis</span> (Jan 2025). Confirm active EpiPen prescription.</li>
        <li><span class="warning">LDL elevated in high-risk patient</span>: Recommend statin review per guidelines.</li>
        <li><span class="warning">BP above target (142/88)</span>: Monitor further. Consider meds if persistent.</li>
        <li>Penicillin allergy (rash): moderate reaction. Caution if β-lactams needed.</li>
      </ul>
    </div>
  </div>

  <!-- =========================
       JavaScript Combined Section
       ========================= -->
  <script>
    // Toggle FAB
    const fabContainer = document.querySelector('.fab-container');
    const fab = document.querySelector('.fab');
    const menuItems = document.querySelectorAll('.menu-item');
    const toolPanels = document.querySelectorAll('.tool-panel');
    const closeButtons = document.querySelectorAll('.close-tool');

    fab.addEventListener('click', () => {
      fabContainer.classList.toggle('active');
      if (fabContainer.classList.contains('active')) {
        setTimeout(() => {
          menuItems.forEach((item, index) => {
            item.classList.add(`position-${index + 1}`);
          });
        }, 100);
      } else {
        menuItems.forEach(item => {
          item.classList.remove(
            'position-1',
            'position-2',
            'position-3',
            'position-4',
            'position-5',
            'position-6'
          );
        });
      }
    });

    // Open each tool panel (doesn't auto-collapse the FAB)
    menuItems.forEach(item => {
      item.addEventListener('click', (e) => {
        e.stopPropagation();
        const toolId = item.getAttribute('data-tool');
        const toolPanel = document.getElementById(toolId);
        if (toolPanel) {
          toolPanels.forEach(panel => {
            panel.style.display = 'none';
          });
          toolPanel.style.display = 'flex';
        }
      });
    });

    // Close tool panels
    closeButtons.forEach(button => {
      button.addEventListener('click', () => {
        const panel = button.closest('.tool-panel');
        panel.style.display = 'none';
        // Collapse the FAB
        fabContainer.classList.remove('active');
        menuItems.forEach(item => {
          item.classList.remove(
            'position-1',
            'position-2',
            'position-3',
            'position-4',
            'position-5',
            'position-6'
          );
        });
      });
    });

    // Collapse FAB on outside click
    document.addEventListener('click', (e) => {
      if (fabContainer.classList.contains('active') && !fabContainer.contains(e.target)) {
        fabContainer.classList.remove('active');
        menuItems.forEach(item => {
          item.classList.remove(
            'position-1',
            'position-2',
            'position-3',
            'position-4',
            'position-5',
            'position-6'
          );
        });
      }
    });

    // Prevent tooltip clicks from closing the FAB
    document.querySelectorAll('.menu-item span').forEach(tooltip => {
      tooltip.addEventListener('click', (e) => {
        e.stopPropagation();
      });
    });

    // Toggle "View" details in the Patient Record
    const viewLinks = document.querySelectorAll('.view-link');
    viewLinks.forEach(link => {
      link.addEventListener('click', () => {
        const targetId = link.getAttribute('data-target');
        const contentDiv = document.getElementById(targetId);
        if (contentDiv) {
          if (contentDiv.style.display === 'block') {
            contentDiv.style.display = 'none';
          } else {
            contentDiv.style.display = 'block';
          }
        }
      });
    });

    // ================================
    // AUTOMATED DOCUMENTATION JS
    // ================================
    const editTemplateLink = document.getElementById('editTemplateLink');
    const templateEditor = document.getElementById('templateEditor');
    const saveTemplateBtn = document.getElementById('saveTemplateBtn');

    // Toggle the Template Editor
    editTemplateLink.addEventListener('click', (e) => {
      e.preventDefault();
      if (templateEditor.style.display === 'none') {
        templateEditor.style.display = 'block';
      } else {
        templateEditor.style.display = 'none';
      }
    });

    // Optional "save" action for template
    saveTemplateBtn.addEventListener('click', () => {
      alert('Template preference saved (demo).');
    });

    // Handle the Submit button to show generated note
    const submitVisitBtn = document.getElementById('submitVisitBtn');
    const generatedSection = document.getElementById('generatedSection');

    submitVisitBtn.addEventListener('click', () => {
      generatedSection.style.display = 'block';
    });

    // Optional: placeholders for other buttons
    document.getElementById('regenerateBtn').addEventListener('click', () => {
      alert('Regenerate Note (demo).');
    });
    document.getElementById('updateEmrBtn').addEventListener('click', () => {
      alert('Update EMR (demo).');
    });
    document.getElementById('copyNoteBtn').addEventListener('click', () => {
      alert('Copy Note to Clipboard (demo).');
    });
    document.getElementById('editNoteBtn').addEventListener('click', () => {
      alert('Edit Note (demo). Just edit the text area above freely.');
    });

    // ================================
    // PRESCRIPTION DEMO LOGIC
    // ================================
    const rxTable = document.getElementById('rxTable');
    const addEmptyRowBtn = document.getElementById('addEmptyRowBtn');
    const medListTable = document.getElementById('medListTable');

    // RISKY DRUG MODAL
    const riskyModal = document.getElementById('riskyModal');
    const riskyDrugMessage = document.getElementById('riskyDrugMessage');
    const cancelRiskBtn = document.getElementById('cancelRiskBtn');
    const continueRiskBtn = document.getElementById('continueRiskBtn');

    let pendingDrugRowData = null;

    medListTable.addEventListener('click', (e) => {
      if (e.target.classList.contains('addMed')) {
        const row = e.target.closest('tr');
        const drugName = row.getAttribute('data-drug');
        const riskLevel = row.getAttribute('data-risk');
        const note = row.getAttribute('data-note');

        if (riskLevel === 'high' || riskLevel === 'medium') {
          riskyDrugMessage.textContent = `Drug: ${drugName} – ${note}. This may pose a serious risk.`;
          riskyModal.style.display = 'flex';
          pendingDrugRowData = { drugName, note };
        } else {
          addNewDrugRow(drugName, note);
        }
      }
    });

    cancelRiskBtn.addEventListener('click', () => {
      riskyModal.style.display = 'none';
      pendingDrugRowData = null;
    });
    continueRiskBtn.addEventListener('click', () => {
      riskyModal.style.display = 'none';
      if (pendingDrugRowData) {
        addNewDrugRow(pendingDrugRowData.drugName, pendingDrugRowData.note);
        pendingDrugRowData = null;
      }
    });

    function addNewDrugRow(drugName, note) {
      const tbody = rxTable.querySelector('tbody');
      const rowCount = tbody.rows.length;
      const newRow = tbody.insertRow(rowCount - 1);
      for (let i = 0; i < 9; i++) {
        const cell = newRow.insertCell(i);
        if (i === 0) {
          const input = document.createElement('input');
          input.value = drugName;
          cell.appendChild(input);
        } else if (i === 7) {
          const input = document.createElement('input');
          input.value = note || '';
          cell.appendChild(input);
        } else if (i === 8) {
          const btn = document.createElement('button');
          btn.textContent = '❌';
          btn.classList.add('delete-btn');
          cell.appendChild(btn);
        } else {
          const input = document.createElement('input');
          input.value = '';
          cell.appendChild(input);
        }
      }
    }

    rxTable.addEventListener('click', (event) => {
      if (event.target.classList.contains('delete-btn')) {
        const row = event.target.closest('tr');
        if (row) {
          row.remove();
        }
      }
    });

    addEmptyRowBtn.addEventListener('click', () => {
      addNewDrugRow('', '');
    });

    // ===============================
    // AUTHORIZATION DEMO LOGIC
    // ===============================
    const revokeAccessBtn = document.getElementById('revokeAccessBtn');
    const revokeAccessBtn2 = document.getElementById('revokeAccessBtn2');
    const revokeModal = document.getElementById('revokeModal');
    const cancelRevokeBtn = document.getElementById('cancelRevokeBtn');
    const confirmRevokeBtn = document.getElementById('confirmRevokeBtn');

    revokeAccessBtn.addEventListener('click', () => {
      revokeModal.style.display = 'flex';
    });
    revokeAccessBtn2.addEventListener('click', () => {
      revokeModal.style.display = 'flex';
    });

    cancelRevokeBtn.addEventListener('click', () => {
      revokeModal.style.display = 'none';
    });
    confirmRevokeBtn.addEventListener('click', () => {
      revokeModal.style.display = 'none';
      alert('Access has been revoked (demo).');
    });

    const extendAccessBtn = document.getElementById('extendAccessBtn');
    const extendAccessPanel = document.getElementById('extendAccessPanel');
    const cancelExtendBtn = document.getElementById('cancelExtendBtn');
    const requestExtendBtn = document.getElementById('requestExtendBtn');

    extendAccessBtn.addEventListener('click', () => {
      if (extendAccessPanel.style.display === 'none') {
        extendAccessPanel.style.display = 'block';
      } else {
        extendAccessPanel.style.display = 'none';
      }
    });
    cancelExtendBtn.addEventListener('click', () => {
      extendAccessPanel.style.display = 'none';
    });
    requestExtendBtn.addEventListener('click', () => {
      extendAccessPanel.style.display = 'none';
      alert('Access extension requested (demo).');
    });

    const requestNewAccessBtn = document.getElementById('requestNewAccessBtn');
    const requestNewAccessPanel = document.getElementById('requestNewAccessPanel');
    const submitNewAccessBtn = document.getElementById('submitNewAccessBtn');

    requestNewAccessBtn.addEventListener('click', () => {
      if (requestNewAccessPanel.style.display === 'none') {
        requestNewAccessPanel.style.display = 'block';
      } else {
        requestNewAccessPanel.style.display = 'none';
      }
    });
    submitNewAccessBtn.addEventListener('click', () => {
      requestNewAccessPanel.style.display = 'none';
      alert('New Access request submitted (demo).');
    });
  </script>
</body>
</html>
